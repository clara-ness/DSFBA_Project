# Analysis

```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```

* Answers to the research questions
* Different methods considered
* Competing approaches
* Justifications

### 1.Do European countries that have higher GDPs really have lower diabetes prevalence ?

This first question serves more as a control, since we learned during our research prior to our project that countries with higher GDPs tend to have lower diabetes rates. Indeed, we can observe that in the EDA. 

It is important to note that, when we try to fit a linear model on these variables and observe correlations over all observations, we see that these relationships are not significant at all.

```{r}
#with outliers
cor(GDP_diabetes_cal$avg_gdp, GDP_diabetes_cal$prop_women_diabetes)
cor(GDP_diabetes_cal$avg_gdp, GDP_diabetes_cal$prop_men_diabetes)

lm_gdp_diabetes_women <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$prop_women_diabetes)

lm_gdp_diabetes_men <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$prop_men_diabetes)

summary(lm_gdp_diabetes_women)
summary(lm_gdp_diabetes_men)
```

However, once we exclude outliers, we see that the relationship is way more significant !

```{r}
#without outliers
cor(GDP_diabetes_cal2$avg_gdp, GDP_diabetes_cal2$prop_women_diabetes)
cor(GDP_diabetes_cal2$avg_gdp, GDP_diabetes_cal2$prop_men_diabetes)

lm_gdp_diabetes_women2 <- lm(GDP_diabetes_cal2$avg_gdp ~ GDP_diabetes_cal2$prop_women_diabetes)

lm_gdp_diabetes_men2 <- lm(GDP_diabetes_cal2$avg_gdp ~ GDP_diabetes_cal2$prop_men_diabetes)

summary(lm_gdp_diabetes_women2)
summary(lm_gdp_diabetes_men2)
```

#### LOOK SPECIFICALLY INTO RICH COUNTRIES ?

### 2.Do European countries that have higher GDPs consume less calories ?

As mentioned in the first point, countries with a higher GDP have a lower diabetes rate which could potentially be explained by the consumption of fewer calories.

But is there a real correlation between these two variables ? Let's check :

```{r}
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$total_consumption)

lm_gdp_total_cal <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$total_consumption)

summary(lm_gdp_total_cal)
```

Neither the correlation between these two variables nor the linear regression is significant. However, it would be interesting to look further.  To do this we can 
make clusters 

```{r}
rownames(GDP_diabetes_cal) <- c("AUT", "BEL", "BGR", "HRV", "CYP", "CZE", "DNK", "EST", "FIN", "FRA", "DEU","GRC", "HUN", "IRL", "ITA", "LVA", "LTU", "LUX", "MLT", "NLD", "POL", "PRT", "ROU", "SVK", "SVN", "ESP", "SWE", "GBR", "CHE")

data_1 <- GDP_diabetes_cal[,-(1:2),drop=FALSE] 
model <- kmeans(data_1, centers = 3)

# displays the class determined by
# the model for all observations:
model$cluster

Data_cluster <- data.frame(data_1,
  cluster = as.factor(model$cluster)
)

head(Data_cluster)

#prediction of cluster 
#install.packages('parameters')
#install.packages('see')
library(see)
library(parameters)

res_kmeans <- cluster_analysis(data_1,
                 n = 3,
                 method = "kmeans")

predict(res_kmeans) # get clusters

plot(res_kmeans)
```


```{r}
#trying to plot the consumption patterns
library(plotly)
library(dplyr)


GDP_diabetes_cal$total_consumption <- sapply(strsplit(rownames(GDP_diabetes_cal), " "), "[[", 1)

df <- GDP_diabetes_cal
df <- df %>% group_by(total_consumption)
df <- df %>% summarize(count = n())
fig <- df %>% plot_ly(labels = ~total_consumption, values = ~count)
fig <- fig %>% add_pie(hole = 0.6)
fig <- fig %>% layout(title = "Donut charts to show consumption patterns",  showlegend = F,
                      xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
                      yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

fig

```



### 3.How do the macronutrients (animal protein/plant protein/fat/carbohydrates) consumed differ between richer and poorer governments ?

We observed during the EDA that richer countries seemed to consume more fat on average.Not we want to see if we can confirm this relationship, and observe if there isn't a correlation between the average GDP of a country and the consumption of other macronutrients too.

```{r}
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_prot_animal)
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_prot_plant)
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_carbs)
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_fat)

lm_gdp_cal_prot_animal <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_prot_animal)
lm_gdp_cal_prot_plant <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_prot_plant)
lm_gdp_cal_carbs <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_carbs)
lm_gdp_cal_fat <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_fat)

summary(lm_gdp_cal_prot_animal)
summary(lm_gdp_cal_prot_plant)
summary(lm_gdp_cal_carbs)
summary(lm_gdp_cal_fat)
```


```{r}
GDP_diabetes_cal <- mutate(GDP_diabetes_cal, proportion_animal_prot = cal_prot_animal/total_consumption, proportion_plant_prot = cal_prot_plant/total_consumption, proportion_carbs = cal_carbs/total_consumption, proportion_fat = cal_fat/total_consumption)

cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$proportion_animal_prot)
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$proportion_plant_prot)
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$proportion_carbs)
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$proportion_fat)

lm_gdp_prop_animal_prot <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$proportion_animal_prot)
lm_gdp_prop_plant_prot <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$proportion_plant_prot)
lm_gdp_prop_carbs <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$proportion_carbs)
lm_gdp_prop_fat <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$proportion_fat)

summary(lm_gdp_prop_animal_prot)
summary(lm_gdp_prop_plant_prot)
summary(lm_gdp_prop_carbs)
summary(lm_gdp_prop_fat)
```

With proportions, correlation is higher than with calorie count and linear regression parameters a bit more significant but the relationship is still not strong enough.

-top 5, last 5 ?

-parler des proportions par rapport aux total calories

-peut-être qu'on doit regarder le PIB par personne pour que les graphiques fassent du sens (j'ai trouvé un dataset) et trouver une relation

-regarder les échelles dans EDA



### 4.How do these differences relate to the diabetes prevalence in these countries ? What is the typical diet that can be observed in richer states that relates to lower diabetes prevalence ?

