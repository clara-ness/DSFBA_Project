# Analysis

```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```

* Answers to the research questions
* Different methods considered
* Competing approaches
* Justifications

## 1.Do European countries that have higher GDPs really have lower diabetes prevalence ?

This first question serves more as a control, since we learned during our research prior to our project that countries with higher GDPs tend to have lower diabetes rates. Indeed, we can observe that in the EDA. 

It is important to note that, when we try to fit a linear model on these variables and observe correlations over all observations, we see that these relationships are not significant at all.

```{r}
#with outliers
cor(GDP_diabetes_cal$avg_gdp, GDP_diabetes_cal$prop_women_diabetes)
cor(GDP_diabetes_cal$avg_gdp, GDP_diabetes_cal$prop_men_diabetes)

lm_gdp_diabetes_women <- lm(avg_gdp ~ prop_women_diabetes, data = GDP_diabetes_cal)

lm_gdp_diabetes_men <- lm(avg_gdp ~ prop_men_diabetes, data = GDP_diabetes_cal)

tab_model(
  lm_gdp_diabetes_women, show.ci = FALSE, show.stat = TRUE, show.se = TRUE,
  CSS = list(
    css.width = '500px',
    css.centeralign = 'text-align: left;', 
    css.firsttablecol = 'font-weight: bold;',  
    css.summary = 'color: black;'
  )
)  
```
<br><br>
```{r}
tab_model(
  lm_gdp_diabetes_men, show.ci = FALSE, show.stat = TRUE, show.se = TRUE,
  CSS = list(
    css.width = '500px',
    css.centeralign = 'text-align: left;', 
    css.firsttablecol = 'font-weight: bold;',  
    css.summary = 'color: black;'
  )
)


```

However, once we exclude outliers, we see that the relationship is way more significant !

```{r}
#without outliers
cor(GDP_diabetes_cal2$avg_gdp, GDP_diabetes_cal2$prop_women_diabetes)
cor(GDP_diabetes_cal2$avg_gdp, GDP_diabetes_cal2$prop_men_diabetes)

lm_gdp_diabetes_women2 <- lm(avg_gdp ~ prop_women_diabetes, data = GDP_diabetes_cal2)

lm_gdp_diabetes_men2 <- lm(avg_gdp ~ prop_men_diabetes, data = GDP_diabetes_cal2)

tab_model(
  lm_gdp_diabetes_women2, show.ci = FALSE, show.stat = TRUE, show.se = TRUE,
  CSS = list(
    css.width = '500px',
    css.centeralign = 'text-align: left;', 
    css.firsttablecol = 'font-weight: bold;',  
    css.summary = 'color: black;'
  )
)  
```
<br><br>
```{r}
tab_model(
  lm_gdp_diabetes_men2, show.ci = FALSE, show.stat = TRUE, show.se = TRUE,
  CSS = list(
    css.width = '500px',
    css.centeralign = 'text-align: left;', 
    css.firsttablecol = 'font-weight: bold;',  
    css.summary = 'color: black;'
  )
)
```

In the EDA section, we grouped countries in 3 categories, according to the relationship between the GDP and diabetes rate. Here, we confirmed statistically that a relationship exists between these 2 variables when we remove outliers. This therefore made us think that these countries could be categorized into clusters.

To determine the number of clusters we used the elbow method. This method examines the percentage of variance explained as a function of the number of clusters. It is based on the idea that a number of clusters should be chosen such that the addition of another cluster does not allow for a better modeling of the data. The percentage of variance explained by the clusters is plotted against the number of clusters.

```{r}
data_1 <- GDP_diabetes_cal[,-(1:2),drop=FALSE] #-> introduce the proportions later on ?
rownames(data_1) <- c("AUT", "BEL", "BGR", "HRV", "CYP", "CZE", "DNK", "EST", "FIN", "FRA", "DEU","GRC", "HUN", "IRL", "ITA", "LVA", "LTU", "LUX", "MLT", "NLD", "POL", "PRT", "ROU", "SVK", "SVN", "ESP", "SWE", "GBR", "CHE")

fviz_nbclust(data_1, kmeans, method = "wss") +
  geom_vline(xintercept = 3, linetype = 2) + # add line for better visualisation
  labs(subtitle = "Elbow method") # add subtitle

```

We therefore see from the graph above that the optimal number of clusters is 3. The allocation of countries according to their cluster is therefore as follows:

```{r}
set.seed(123)

model_cluster <- kmeans(data_1, centers = 3, nstart = 10)

Data_cluster <- data.frame(data_1, cluster = as.factor(model_cluster$cluster))

countries_cluster_1 <- filter(Data_cluster, cluster == "1")
countries_cluster_2 <- filter(Data_cluster, cluster == "2") 
countries_cluster_3 <- filter(Data_cluster, cluster == "3")

kbl(countries_cluster_1,
    caption = "**Table**: Cluster 1",
    align = c('cccccc')) %>%
   kable_classic(full_width = T, html_font = "Cambria") %>%
   kable_styling(bootstrap_options = c('striped', 'hover', 'condensed')) 
kbl(countries_cluster_2,
    caption = "**Table**: Cluster 2",
    align = c('cccccc')) %>%
   kable_classic(full_width = T, html_font = "Cambria") %>%
   kable_styling(bootstrap_options = c('striped', 'hover', 'condensed'))
kbl(countries_cluster_3,
    caption = "**Table**: Cluster 3",
    align = c('cccccc')) %>%
   kable_classic(full_width = T, html_font = "Cambria") %>%
   kable_styling(bootstrap_options = c('striped', 'hover', 'condensed'))
```

It is important to note that our 3rd cluster only contains 2 countries, and therefore when we analyse correlation and linear regression parameters, we will be mainly considering the overall nature of the relationships. (positive or negative link?)

Now let's plot these clusters to see the differences between them.

```{r}
res_kmeans <- cluster_analysis(data_1, n=3, method = "kmeans",iterations = 20)

predict(res_kmeans)

plot(res_kmeans)
```

In the graph above,

* Group 1 = Cluster 3
* Group 2 = Cluster 2
* Group 3 = Cluster 1

We can therefore see that diabetes is indeed lower in clusters which contain the countries with higher GPDs. Let's see if this relationship is significant within each cluster :

```{r}
#cluster 1
cor(countries_cluster_1$avg_gdp, countries_cluster_1$prop_women_diabetes)
cor(countries_cluster_1$avg_gdp, countries_cluster_1$prop_men_diabetes)

lm_gdp_diabetes_women_clust1 <- lm(countries_cluster_1$avg_gdp ~ countries_cluster_1$prop_women_diabetes)
lm_gdp_diabetes_men_clust1 <- lm(countries_cluster_1$avg_gdp ~ countries_cluster_1$prop_men_diabetes)

kable(prettify(summary(lm_gdp_diabetes_women_clust1)))
kable(prettify(summary(lm_gdp_diabetes_men_clust1)))


#cluster 2
cor(countries_cluster_2$avg_gdp, countries_cluster_2$prop_women_diabetes)
cor(countries_cluster_2$avg_gdp, countries_cluster_2$prop_men_diabetes)

lm_gdp_diabetes_women_clust2 <- lm(countries_cluster_2$avg_gdp ~ countries_cluster_2$prop_women_diabetes)
lm_gdp_diabetes_men_clust2 <- lm(countries_cluster_2$avg_gdp ~ countries_cluster_2$prop_men_diabetes)

kable(prettify(summary(lm_gdp_diabetes_women_clust2)))
kable(prettify(summary(lm_gdp_diabetes_men_clust2)))


#cluster 3
cor(countries_cluster_3$avg_gdp, countries_cluster_3$prop_women_diabetes)
cor(countries_cluster_3$avg_gdp, countries_cluster_3$prop_men_diabetes)

lm_gdp_diabetes_women_clust3 <- lm(countries_cluster_3$avg_gdp ~ countries_cluster_3$prop_women_diabetes)
lm_gdp_diabetes_men_clust3 <- lm(countries_cluster_3$avg_gdp ~ countries_cluster_3$prop_men_diabetes)

kable(prettify(summary(lm_gdp_diabetes_women_clust3)))
kable(prettify(summary(lm_gdp_diabetes_men_clust3)))
```

Clustering here doesn't necessarily help us answer the research question. We can confirm with the previous statistical test without outliers that overall, the GDP of a country and its diabetes rate are negatively correlated. 

However, the clusters defined above could help us answer our other research questions.


## 2.Do European countries that have higher GDPs consume less calories ?

As mentioned in the first point, countries with a higher GDP tend to have a lower diabetes rate, which could potentially be explained by the consumption of fewer calories.

But is there a real correlation between these two variables ? Let's check :

```{r}
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$total_consumption)

lm_gdp_total_cal <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$total_consumption)

kable(prettify(summary(lm_gdp_total_cal)))
```

Neither the correlation between these two variables nor the linear regression is significant. However, it would be interesting to look further. First, we can see if using the GDP per person instead of the total average makes a difference.

```{r}
ggplot() + 
  geom_point(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = total_consumption), color = "orange") +
  geom_smooth(mapping = aes(x = GDP_diabetes_cal$gdp_per_person, y=GDP_diabetes_cal$total_consumption), color = "orange", method = "lm") +
  labs(x = "GDP per capita", y= "Calories")
```

The plot looks more or less the same as the one in the EDA section without the outliers. But is the relationship with this new variable statistically significant ?

```{r}
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$total_consumption)

lm_gdp_pp_total_cal <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$total_consumption)

kable(prettify(summary(lm_gdp_pp_total_cal)))
```

We see that the correlation with the variable `gdp_per_person`is higher now and the significance of the parameter in the regression, even though not high enough, increased.

Next we can proceed with an analysis within clusters, with the ones defined in the first question.

```{r}
#cluster 1
cor(countries_cluster_1$gdp_per_person, countries_cluster_1$total_consumption)

lm_gdp_total_cal_clust1 <- lm(countries_cluster_1$gdp_per_person ~ countries_cluster_1$total_consumption)

kable(prettify(summary(lm_gdp_total_cal_clust1)))


#cluster 2
cor(countries_cluster_2$gdp_per_person, countries_cluster_2$total_consumption)

lm_gdp_total_cal_clust2 <- lm(countries_cluster_2$gdp_per_person ~ countries_cluster_2$total_consumption)

kable(prettify(summary(lm_gdp_total_cal_clust2)))


#cluster 3
cor(countries_cluster_3$gdp_per_person, countries_cluster_3$total_consumption)

lm_gdp_total_cal_clust3 <- lm(countries_cluster_3$gdp_per_person ~ countries_cluster_3$total_consumption)

kable(prettify(summary(lm_gdp_total_cal_clust3)))
```

The results indicate that even within the clusters, these variables are not exactly correlated and the total calories consumed per person in a country is not a significant indicator of this country's wealth.

When we look at our cluster plot, in terms of total calorie intake it is also the 1st cluster, which contains the richest countries considering GDP per capita, that consumes the most calories. One might therefore think that calorie consumption is not the main reason why high-GDP countries have lower diabetes rates.


## 3.How do the macronutrients (animal protein/plant protein/carbohydrates/fat) consumed differ between richer and poorer countries ?

We observed during the EDA that richer countries seemed to consume more fat on average. Now we want to see if we can confirm this relationship, and find out if there is a correlation between the average GDP of a country and the calories consumed for other macronutrients too.

Since the units of the variables "calories consumed from animal protein/plant protein/carbs/fat" are on a per capita basis, we think that including the GDP per capita in this part of the analysis could improve results. Additionally, we thought that another way of answering this research question could be to include the proportions of the calories consumed from different macronutrients on the total calories and see if it affects our analysis. 

```{r}
#adding proportions to the final table
GDP_diabetes_cal <- mutate(GDP_diabetes_cal, proportion_animal_prot = cal_prot_animal/total_consumption, proportion_plant_prot = cal_prot_plant/total_consumption, proportion_carbs = cal_carbs/total_consumption, proportion_fat = cal_fat/total_consumption)
```

With these new metrics introduced, we will plot these relationships again.

```{r}
#with GDP per person + calories
ggplot() + 
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = total_consumption), color = "orange") +
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = cal_fat), color = "blue") +
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = cal_carbs), color = "purple") +
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = cal_prot_animal), color = "red") +  
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = cal_prot_plant), color = "green") +
  labs(x = "GDP per capita", y= "Calories")

#with GDP per person + proportions
ggplot() + 
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = proportion_fat), color = "blue") +
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = proportion_carbs), color = "purple") +
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = proportion_animal_prot), color = "red") +  
  geom_line(data = GDP_diabetes_cal, aes(x = gdp_per_person, y = proportion_plant_prot), color = "green") +
  labs(x = "GDP per capita", y= "Proportion of calories")
```

It is also important to plot the clusters again to observe differences in the proportions of calories consumed.

```{r}
#clustering pt 2
data_2 <- mutate(data_1, GDP_diabetes_cal[,12:15])

set.seed(123)

model_cluster_bis <- kmeans(data_2, centers = 3, nstart = 10)

Data_cluster_bis <- data.frame(data_2, cluster = as.factor(model_cluster_bis$cluster))

countries_cluster_1bis <- filter(Data_cluster_bis, cluster == "1")
countries_cluster_2bis <- filter(Data_cluster_bis, cluster == "2") 
countries_cluster_3bis <- filter(Data_cluster_bis, cluster == "3")

res_kmeans_bis <- cluster_analysis(data_2, n=3, method = "kmeans",iterations = 20)

predict(res_kmeans_bis)

plot(res_kmeans_bis)
```

We will be referring to these graphs in our analysis in the next sections.

### GDP - Animal protein

Let's start with by analysing the relationship between a country's wealth and it's consumption of animal protein. We saw at the EDA section that there didn't seem to be a trend between these 2 variables, overall the calories consumed from animal protein is very stable regardless of the average GDP of a country. We can confirm this by checking the correlation and by trying to fit a linear regression.

```{r}
#Average GDP - calories
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_prot_animal)

lm_gdp_cal_prot_animal <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_prot_animal)

kable(prettify(summary(lm_gdp_cal_prot_animal)))
```

Even though the correlation is positive, it is not very high. By looking at the summary of the linear regression, we can also see that the parameter is not significant. This could maybe be explained by the fact that variance is very high at the left part of the graph where the average GDP is lower. But what if we took the GDP per capita instead of the average GDP of a country ? The graph above seems to show again that the consumption of this macronutrient is very stable regardless of the GDP per capita of a country.

```{r}
#GDP per capita - calories
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$cal_prot_animal)

lm_gdp_pp_cal_prot_animal <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$cal_prot_animal)

kable(prettify(summary(lm_gdp_pp_cal_prot_animal)))
```

This time, the correlation is higher and the variable's estimate as a parameter is very significant ! Maybe the correlation can improve by considering proportion of calories instead of the calorie count.

```{r}
#GDP per capita - proportion
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$proportion_animal_prot)

lm_gdp_pp_prop_animal_prot <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$proportion_animal_prot)

kable(prettify(summary(lm_gdp_pp_prop_animal_prot)))
```

Here, the correlation is slightly lower than with the calorie count and the parameter's estimate is a bit less significant but still quite solid. Now let's see if we can find better explanations within our defined clusters.

From our cluster plot above, we see that high GDP countries (clusters 1 and 3) tend to consume more calories of animal protein than low GDP countries, this is also the case for the proportions of calories consumed from animal protein. Are the correlations and linear regression in line with these observations ?

```{r}
#cluster 1
cor(countries_cluster_1bis$gdp_per_person, countries_cluster_1bis$proportion_animal_prot)

lm_gdp_pp_prop_animal_prot_clust1 <- lm(countries_cluster_1bis$gdp_per_person ~ countries_cluster_1bis$proportion_animal_prot)

kable(prettify(summary(lm_gdp_pp_prop_animal_prot_clust1)))


#cluster 2
cor(countries_cluster_2bis$gdp_per_person, countries_cluster_2bis$proportion_animal_prot)

lm_gdp_pp_prop_animal_prot_clust2 <- lm(countries_cluster_2bis$gdp_per_person ~ countries_cluster_2bis$proportion_animal_prot)

kable(prettify(summary(lm_gdp_pp_prop_animal_prot_clust2)))


#cluster 3
cor(countries_cluster_3bis$gdp_per_person, countries_cluster_3bis$proportion_animal_prot)

lm_gdp_pp_prop_animal_prot_clust3 <- lm(countries_cluster_3bis$gdp_per_person ~ countries_cluster_3bis$proportion_animal_prot)

kable(prettify(summary(lm_gdp_pp_prop_animal_prot_clust3)))
```

For each cluster, the correlation is positive and but still not so high, and the estimate of the parameter for cluster 2 is significant.

In general, though it seems positive, we cannot conclude that there is a correlation between the wealth of a country and its animal protein.

### GDP - Plant protein

Let's start with by analysing the relationship between a country's wealth and it's consumption of animal protein. We saw at the EDA section that there didn't seem to be a trend between these 2 variables, overall the calories consumed from animal protein is very stable regardless of the average GDP of a country. We can confirm this by checking the correlation and by trying to fit a linear regression. --> modify

```{r}
#Average GDP - calories
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_prot_plant)

lm_gdp_cal_prot_plant <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_prot_plant)

kable(prettify(summary(lm_gdp_cal_prot_plant)))
```

```{r}
#GDP per capita - calories
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$cal_prot_plant)

lm_gdp_pp_cal_prot_plant <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$cal_prot_plant)

kable(prettify(summary(lm_gdp_pp_cal_prot_plant)))
```


```{r}
#GDP per capita - proportion
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$proportion_plant_prot)

lm_gdp_pp_prop_plant_prot <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$proportion_plant_prot)

kable(prettify(summary(lm_gdp_pp_prop_plant_prot)))
```

```{r}
#cluster 1
cor(countries_cluster_1bis$gdp_per_person, countries_cluster_1bis$proportion_plant_prot)

lm_gdp_pp_prop_plant_prot_clust1 <- lm(countries_cluster_1bis$gdp_per_person ~ countries_cluster_1bis$proportion_plant_prot)

kable(prettify(summary(lm_gdp_pp_prop_plant_prot_clust1)))


#cluster 2
cor(countries_cluster_2bis$gdp_per_person, countries_cluster_2bis$proportion_plant_prot)

lm_gdp_pp_prop_plant_prot_clust2 <- lm(countries_cluster_2bis$gdp_per_person ~ countries_cluster_2bis$proportion_plant_prot)

kable(prettify(summary(lm_gdp_pp_prop_plant_prot_clust2)))


#cluster 3
cor(countries_cluster_3bis$gdp_per_person, countries_cluster_3bis$proportion_plant_prot)

lm_gdp_pp_prop_plant_prot_clust3 <- lm(countries_cluster_3bis$gdp_per_person ~ countries_cluster_3bis$proportion_plant_prot)

kable(prettify(summary(lm_gdp_pp_prop_plant_prot_clust3)))
```

### GDP - Carbohydrates

```{r}
#Average GDP - calories
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_carbs)

lm_gdp_cal_carbs <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_carbs)

kable(prettify(summary(lm_gdp_cal_carbs)))
```

```{r}
#GDP per capita - calories
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$cal_carbs)

lm_gdp_pp_cal_carbs <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$cal_carbs)

kable(prettify(summary(lm_gdp_pp_cal_carbs)))
```


```{r}
#GDP per capita - proportion
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$proportion_carbs)

lm_gdp_pp_prop_carbs <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$proportion_carbs)

kable(prettify(summary(lm_gdp_pp_prop_carbs)))
```

```{r}
#cluster 1
cor(countries_cluster_1bis$gdp_per_person, countries_cluster_1bis$proportion_carbs)

lm_gdp_pp_prop_carbs_clust1 <- lm(countries_cluster_1bis$gdp_per_person ~ countries_cluster_1bis$proportion_carbs)

kable(prettify(summary(lm_gdp_pp_prop_carbs_clust1)))


#cluster 2
cor(countries_cluster_2bis$gdp_per_person, countries_cluster_2bis$proportion_carbs)

lm_gdp_pp_prop_carbs_clust2 <- lm(countries_cluster_2bis$gdp_per_person ~ countries_cluster_2bis$proportion_carbs)

kable(prettify(summary(lm_gdp_pp_prop_carbs_clust2)))


#cluster 3
cor(countries_cluster_3bis$gdp_per_person, countries_cluster_3bis$proportion_carbs)

lm_gdp_pp_prop_carbs_clust3 <- lm(countries_cluster_3bis$gdp_per_person ~ countries_cluster_3bis$proportion_carbs)

kable(prettify(summary(lm_gdp_pp_prop_carbs_clust3)))
```

### GDP - Fats

```{r}
#Average GDP - calories
cor(GDP_diabetes_cal$avg_gdp,GDP_diabetes_cal$cal_fat)

lm_gdp_cal_fat <- lm(GDP_diabetes_cal$avg_gdp ~ GDP_diabetes_cal$cal_fat)

kable(prettify(summary(lm_gdp_cal_fat)))
```

```{r}
#GDP per capita - calories
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$cal_fat)

lm_gdp_pp_cal_fat <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$cal_fat)

kable(prettify(summary(lm_gdp_pp_cal_fat)))
```


```{r}
#GDP per capita - proportion
cor(GDP_diabetes_cal$gdp_per_person,GDP_diabetes_cal$proportion_fat)

lm_gdp_pp_prop_fat <- lm(GDP_diabetes_cal$gdp_per_person ~ GDP_diabetes_cal$proportion_fat)

kable(prettify(summary(lm_gdp_pp_prop_fat)))
```

```{r}
#cluster 1
cor(countries_cluster_1bis$gdp_per_person, countries_cluster_1bis$proportion_fat)

lm_gdp_pp_prop_fat_clust1 <- lm(countries_cluster_1bis$gdp_per_person ~ countries_cluster_1bis$proportion_fat)

kable(prettify(summary(lm_gdp_pp_prop_fat_clust1)))


#cluster 2
cor(countries_cluster_2bis$gdp_per_person, countries_cluster_2bis$proportion_fat)

lm_gdp_pp_prop_fat_clust2 <- lm(countries_cluster_2bis$gdp_per_person ~ countries_cluster_2bis$proportion_fat)

kable(prettify(summary(lm_gdp_pp_prop_fat_clust2)))


#cluster 3
cor(countries_cluster_3bis$gdp_per_person, countries_cluster_3bis$proportion_fat)

lm_gdp_pp_prop_fat_clust3 <- lm(countries_cluster_3bis$gdp_per_person ~ countries_cluster_3bis$proportion_fat)

kable(prettify(summary(lm_gdp_pp_prop_fat_clust3)))
```

Analysis points :

- The relationship between the average GDP of a country and the calories consumed from fat per person is the only macronutriment that is significant. For other macronutriments, there seems to be no correlation at all.


## 4.How do these differences in macronutrients relate to the diabetes prevalence in these countries ? What is the typical diet that can be observed in richer states that relates to lower diabetes prevalence ?

What we observed in the EDA seemed to not make sense as we were expecting a positive relationship between the total calories/calories consumed from fat and diabetes prevalence in a country. Let's see now concretely if there is any correlation between the calories consumed from different macronutrients and the diabetes rate.

Oddly enough, it seems that a higher consumption of animal protein could be related to the rate of diabetes, which would be counter-intuitive to M. Adeva-Andany's (2019) article "Dietary habits contribute to define the risk of type 2 diabetes in humans". --> where to add ?


```{r}
#calories animal protein
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$cal_prot_animal)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$cal_prot_animal)

#calories plant protein
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$cal_prot_plant)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$cal_prot_plant)

#calories carbs
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$cal_carbs)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$cal_carbs)

#calories fat
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$cal_fat)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$cal_fat)
```

The correlations are quite significant for fat calories, animal protein and also for plant protein. Nevertheless, carbs would not have a huge effect on the rate of diabetes. Furthermore, it is interesting to note that the correlation is always higher for women. Perhaps malnutrition raises the risk of diabetes in women more than in men? We will continue this analysis by running linear regressions. 

```{r}
#calories animal protein
lm_diabetes_men_cal_prot_animal <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$cal_prot_animal)
lm_diabetes_women_cal_prot_animal <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$cal_prot_animal)

kable(prettify(summary(lm_diabetes_men_cal_prot_animal)))
kable(prettify(summary(lm_diabetes_women_cal_prot_animal)))


#calories plant protein
lm_diabetes_men_cal_prot_plant <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$cal_prot_plant)
lm_diabetes_women_cal_prot_plant <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$cal_prot_plant)

kable(prettify(summary(lm_diabetes_men_cal_prot_plant)))
kable(prettify(summary(lm_diabetes_women_cal_prot_plant)))


#calories carbs
lm_diabetes_men_cal_carbs <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$cal_carbs)
lm_diabetes_women_cal_carbs <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$cal_carbs)


kable(prettify(summary(lm_diabetes_men_cal_carbs)))
kable(prettify(summary(lm_diabetes_women_cal_carbs)))


#calories fat
lm_diabetes_men_cal_fat <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$cal_fat)
lm_diabetes_women_cal_fat <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$cal_fat)

kable(prettify(summary(lm_diabetes_men_cal_fat)))
kable(prettify(summary(lm_diabetes_women_cal_fat)))
```

Only animal protein and fat are significant for women which will further support the view that malnutrition has a greater impact on the rate of diabetes in women than in men. We will now take the proportions to get a better idea of the relationship of macronutrients to diabetes rates.

```{r}
#proportion animal protein
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$proportion_animal_prot)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$proportion_animal_prot)

#proportion plant protein
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$proportion_plant_prot)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$proportion_plant_prot)

#proportion carbs
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$proportion_carbs)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$proportion_carbs)

#proportion fat
cor(GDP_diabetes_cal$prop_men_diabetes,GDP_diabetes_cal$proportion_fat)
cor(GDP_diabetes_cal$prop_women_diabetes,GDP_diabetes_cal$proportion_fat)
```


```{r}
#proportion animal protein
lm_diabetes_men_prop_prot_animal <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$proportion_animal_prot)
lm_diabetes_women_prop_prot_animal <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$proportion_animal_prot)

kable(prettify(summary(lm_diabetes_men_prop_prot_animal)))
kable(prettify(summary(lm_diabetes_women_prop_prot_animal)))


#proportion plant protein
lm_diabetes_men_prop_prot_plant <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$proportion_plant_prot)
lm_diabetes_women_prop_prot_plant <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$proportion_plant_prot)

kable(prettify(summary(lm_diabetes_men_prop_prot_plant)))
kable(prettify(summary(lm_diabetes_women_prop_prot_plant)))


#proportion carbs
lm_diabetes_men_prop_carbs <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$proportion_carbs)
lm_diabetes_women_prop_carbs <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$proportion_carbs)

kable(prettify(summary(lm_diabetes_men_prop_carbs)))
kable(prettify(summary(lm_diabetes_women_prop_carbs)))


#proportion fat
lm_diabetes_men_prop_fat <- lm(GDP_diabetes_cal$prop_men_diabetes ~ GDP_diabetes_cal$proportion_fat)
lm_diabetes_women_prop_fat <- lm(GDP_diabetes_cal$prop_women_diabetes ~ GDP_diabetes_cal$proportion_fat)

kable(prettify(summary(lm_diabetes_men_prop_fat)))
kable(prettify(summary(lm_diabetes_women_prop_fat)))
```
All macronutrients except protein are highly significant for women, which confirms our hypothesis that malnutrition has a greater impact on the rate of diabetes in women than in men. 

We are going to investigate this very issue of calorie consumption patterns that could be related to low diabetes rate for each cluster. To see the patterns of each cluster we will average each cluster. 
```{r}
#means for each cluster
countries_cluster_1 <- countries_cluster_1[,-10]
cl1 <- summarize_all(countries_cluster_1, mean)
cl1 <- rbind(countries_cluster_1, cl1)
row.names(cl1)[12] <- ("Means")
kable(cl1[12,])

countries_cluster_2 <- countries_cluster_2[,-10]
cl2 <- summarize_all(countries_cluster_2, mean)
cl2 <- rbind(countries_cluster_2, cl2)
row.names(cl2)[17] <- ("Means")
kable(cl2[17,])

countries_cluster_3 <- countries_cluster_3[,-10]
cl3 <- summarize_all(countries_cluster_3, mean)
cl3 <- rbind(countries_cluster_3, cl3)
row.names(cl3)[3] <- ("Means")
kable(cl3[3,])
```
As we see from the cluster averages, cluster 2 has the highest rate of diabetes followed by cluster 1 and finally the cluster 3 with the lowest rate of diabetes. 
```{r}
slices <- c(cl1[12,5],cl1[12,6],cl1[12,7], cl1[12,8] )
lbls <- c("Animal Protein", "Plant Protein", "Carbs", "Fat")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices, labels = lbls,col=rainbow(length(lbls)), main="Pie Chart of Consumption Pattern of Cluster 1")

slices <- c(cl2[17,5],cl2[17,6],cl2[17,7], cl2[17,8] )
lbls <- c("Animal Protein", "Plant Protein", "Carbs", "Fat")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices, labels = lbls,col=rainbow(length(lbls)), main="Pie Chart of Consumption Pattern of Cluster 2")

slices <- c(cl3[3,5],cl3[3,6],cl3[3,7], cl3[3,8] )
lbls <- c("Animal Protein", "Plant Protein", "Carbs", "Fat")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices, labels = lbls,col=rainbow(length(lbls)), main="Pie Chart of Consumption Pattern of Cluster 3")

```

There is not much difference between the different patterns for the different clusters. However, it should be noted that carbs represent 53% of the diet of cluster 2 and that this food greatly influences the rate of diabetes, particularly among women.  Indeed, there is a 1% increase in diabetes for every 0.168 carbs consumed on average per capita with a significant p-value at 1%. The proportion of carbs should therefore be reduced to less than half of the total proportion to try to have a negative impact on the diabetes rate.

Strangely enough, the proportion of fat is lower in cluster 1 (33%) which has the highest diabetes rate which is therefore counter intuitive. But this result is consistent with the negative correlations of fat with diabetes rate calculated above. It is therefore complicated to draw a conclusion regarding the proportion of fat to be consumed to reduce the diabetes rate. Our hypothesis is that even if cluster 1 consumes more fat, it is composed of rich countries that have more prevention measures and certainly better hospital infrastructure.
