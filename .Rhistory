#diabetes vs total consumption
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs total calories per day", x="Total calories per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
#diabetes vs calories from animal protein
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from animal protein", x="Total calories from animal protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
#diabetes vs calories from plant protein
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from plant protein", x="Total calories from plant protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
#diabetes vs calories from carbohydrates
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from carbohydrates", x="Total calories from carbohydrates per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs total calories per day (without outliers)", x="Total calories per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
#diabetes vs calories from animal protein
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from animal protein (without outliers)", x="Total calories from animal protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
#diabetes vs calories from plant protein
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from plant protein (without outliers)", x="Total calories from plant protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
#diabetes vs calories from carbohydrates
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from carbohydrates (without outliers)", x="Total calories from carbohydrates per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
ggplot() +
geom_line(data = GDP_diabetes_cal, aes(x = avg_gdp, y = total_consumption), color = "orange") +
geom_line(data = GDP_diabetes_cal, aes(x = avg_gdp, y = cal_fat), color = "blue") +
geom_line(data = GDP_diabetes_cal, aes(x = avg_gdp, y = cal_carbs), color = "purple") +
geom_line(data = GDP_diabetes_cal, aes(x = avg_gdp, y = cal_prot_animal), color = "red") +
geom_line(data = GDP_diabetes_cal, aes(x = avg_gdp, y = cal_prot_plant), color = "green") +
labs(x = "GDP", y= "Calories")
ggplot(GDP_diabetes_cal, aes(x=GDP_diabetes_cal$avg_gdp, y=GDP_diabetes_cal$total_consumption)) +
geom_point() + # Show dots
geom_text(
label= (GDP_diabetes_cal$country_code),
nudge_x = 0.25, nudge_y = 0.25,
check_overlap = T)+
geom_smooth(mapping = aes(x = GDP_diabetes_cal$avg_gdp, y=GDP_diabetes_cal$total_consumption), color = "red", method = "lm")+
labs( x = "Average GDP"), y = "Calories")
ggplot(GDP_diabetes_cal, aes(x=GDP_diabetes_cal$avg_gdp, y=GDP_diabetes_cal$total_consumption)) +
geom_point() + # Show dots
geom_text(
label= (GDP_diabetes_cal$country_code),
nudge_x = 0.25, nudge_y = 0.25,
check_overlap = T)+
geom_smooth(mapping = aes(x = GDP_diabetes_cal$avg_gdp, y=GDP_diabetes_cal$total_consumption), color = "red", method = "lm")+
labs( x = "Average GDP", y = "Calories")
ggplot(GDP_diabetes_cal2, aes(x=GDP_diabetes_cal2$avg_gdp, y=GDP_diabetes_cal2$total_consumption)) +
geom_point() + # Show dots
geom_text(
label= (GDP_diabetes_cal2$country_code),
nudge_x = 0.25, nudge_y = 0.25,
check_overlap = T)+
geom_smooth(mapping = aes(x = GDP_diabetes_cal2$avg_gdp, y=GDP_diabetes_cal2$total_consumption), color = "red", method = "lm")+
labs("Average GDP", y = "Calories")
ggplot(GDP_diabetes_cal2, aes(x=GDP_diabetes_cal2$avg_gdp, y=GDP_diabetes_cal2$total_consumption)) +
geom_point() + # Show dots
geom_text(
label= (GDP_diabetes_cal2$country_code),
nudge_x = 0.25, nudge_y = 0.25,
check_overlap = T)+
geom_smooth(mapping = aes(x = GDP_diabetes_cal2$avg_gdp, y=GDP_diabetes_cal2$total_consumption), color = "red", method = "lm")+
labs(x = "Average GDP", y = "Calories")
View(Diabetes_EU)
View(Diabetes_EU_men)
View(GDP_diabetes_cal)
View(GDP_diabetes_cal2)
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_fat, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_fat, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_fat, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_fat, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from fat", x="Total calories from fat per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs total calories
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs total calories per day", x="Total calories per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from animal protein
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from animal protein", x="Total calories from animal protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from plant protein
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from plant protein", x="Total calories from plant protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from carbohydrates
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from carbohydrates", x="Total calories from carbohydrates per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from fat
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = cal_fat, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_fat, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_fat, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_fat, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from fat", x="Total calories from fat per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs total calories
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = total_consumption, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs total calories per day (without outliers)", x="Total calories per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from animal protein
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_animal, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from animal protein (without outliers)", x="Total calories from animal protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from plant protein
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_prot_plant, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from plant protein (without outliers)", x="Total calories from plant protein per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from carbohydrates
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_carbs, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from carbohydrates (without outliers)", x="Total calories from carbohydrates per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
# Diabetes vs calories from fat
ggplot(data = GDP_diabetes_cal2) +
geom_point(mapping = aes(x = cal_fat, y = prop_men_diabetes, color = "blue")) +
geom_smooth(mapping = aes(x = cal_fat, y = prop_men_diabetes, color = "blue"), formula = y ~ x, method = "lm") +
geom_point(mapping = aes(x = cal_fat, y = prop_women_diabetes, color = "red")) +
geom_smooth(mapping = aes(x = cal_fat, y = prop_women_diabetes, color = "red"), formula = y ~ x, method = "lm") +
labs(title="Diabetes vs daily calories from fat (without outliers)", x="Total calories from fat per day", y="Diabetes prevalence") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red")) +
scale_y_continuous(labels = scales::percent)
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = avg_gdp, y = prop_men_diabetes),color = "blue") +
geom_point(mapping = aes(x = avg_gdp, y = prop_women_diabetes), color = "red") +
labs(x="GDP",y="Diabetes rate") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red"))
source(here::here("scripts/setup.R"))
daily_caloric <- read_csv(here::here("data/daily-caloric.csv"))
daily_caloric <- subset(daily_caloric, Year >= 2000)
EU <- c("AUT", "BEL", "BGR", "HRV", "CYP", "CZE", "DNK", "EST", "FIN", "FRA", "DEU", "GRC", "HUN", "IRL", "ITA", "LVA", "LTU", "LUX", "MLT", "NLD", "POL", "PRT", "ROU", "SVK", "SVN", "ESP", "SWE", "GBR", "CHE")
daily_caloric<-daily_caloric[daily_caloric$Code %in% EU,]
daily_caloric
setDT(daily_caloric)[ , Calories_from_animal_protein := mean(`Calories from animal protein (FAO (2017))`), by = "Entity"]
setDT(daily_caloric)[ , Calories_from_plant_protein := mean(`Calories from plant protein (FAO (2017))`), by = "Entity"]
setDT(daily_caloric)[ , Calories_from_carbohydrates := mean(`Calories from carbohydrates (FAO (2017))`), by = "Entity"]
setDT(daily_caloric)[ , Calories_from_fat := mean(`Calories from fat (FAO (2017))`), by = "Entity"]
Caloric_consumption <- data.table(daily_caloric$Entity,daily_caloric$Code,daily_caloric$Calories_from_animal_protein, daily_caloric$Calories_from_plant_protein,daily_caloric$Calories_from_carbohydrates,daily_caloric$Calories_from_fat)
Caloric_consumption <-Caloric_consumption[!duplicated(Caloric_consumption)]
Caloric_consumption <- Caloric_consumption[,-1]
colnames(Caloric_consumption) <- c("country_code", "cal_prot_animal", "cal_prot_plant", "cal_carbs","cal_fat")
Caloric_consumption <-Caloric_consumption %>%
group_by(country_code) %>%
mutate(
total_consumption = sum(c(cal_prot_animal,cal_prot_plant,cal_carbs,cal_fat)))
GDP <- read_excel(here::here("data/GDP(1960-2020).xls"))
GDP
colnames(GDP) <- GDP[3,]
GDP <- GDP[-c(1:3),-c(3:44,59:65)]
GDP <- GDP[GDP$"Country Code" %in% EU,]
GDP <- GDP %>% pivot_longer(c('2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012','2013'),names_to = "Year",values_to = "Gross Domestic Product")
colnames(GDP) <- c("country_name","country_code","year","avg_gdp")
GDP$avg_gdp <- as.numeric(GDP$avg_gdp)/1000000000
GDP_summarized <- GDP %>%
group_by(country_name, country_code) %>%
summarize(avg_gdp = mean(avg_gdp))
Diabetes <- read_csv(here::here("data/Diabetes.csv"))
Diabetes <- subset(Diabetes, Year >= 2000 , Year <=2013)
Diabetes_EU<-Diabetes[Diabetes$`ISO` %in% EU,]
Diabetes_EU
Diabetes_EU <- Diabetes_EU[-c(1,6,7)]
colnames(Diabetes_EU)<-c("ISO","sex","year","prop_diabetes")
Diabetes_EU_men <-subset(Diabetes_EU, sex=="Men")
Diabetes_EU_men
Diabetes_EU_women <-subset(Diabetes_EU, sex=="Women")
Diabetes_EU_women
colnames(Diabetes_EU_men)<-c("country_code","sex","year","prop_men_diabetes")
colnames(Diabetes_EU_women)<-c("country_code","sex","year","prop_women_diabetes")
Diabetes_EU_men <- Diabetes_EU_men %>%
group_by(country_code) %>%
summarize(prop_men_diabetes = mean(prop_men_diabetes))
Diabetes_EU_men
Diabetes_EU_women <- Diabetes_EU_women %>%
group_by(country_code) %>%
summarize(prop_women_diabetes = mean(prop_women_diabetes))
Diabetes_EU_women
GDP_diabetes_cal <-full_join(GDP_summarized,Diabetes_EU_men, by="country_code")
GDP_diabetes_cal <-full_join(GDP_diabetes_cal,Diabetes_EU_women, by="country_code")
GDP_diabetes_cal <-full_join(GDP_diabetes_cal ,Caloric_consumption, by="country_code")
GDP_diabetes_cal
ggplot(data = GDP_diabetes_cal) +
geom_point(mapping = aes(x = avg_gdp, y = prop_men_diabetes),color = "blue") +
geom_point(mapping = aes(x = avg_gdp, y = prop_women_diabetes), color = "red") +
labs(x="GDP",y="Diabetes rate") +
scale_color_manual(labels = c("Men", "Women"), values = c("blue", "red"))
install.packages("leaflet")
library(leaflet)
#test
m <- leaflet() %>%
addTiles() %>%  # Add default OpenStreetMap map tiles
addMarkers(lng=174.768, lat=-36.852, popup="The birthplace of R")
install.packages("leaflet")
library(leaflet)
#test
m <- leaflet() %>%
addTiles() %>%  # Add default OpenStreetMap map tiles
addMarkers(lng=174.768, lat=-36.852, popup="The birthplace of R")
setView(Europe)
m  # Print the map
source(here::here("scripts/setup.R"))
source(here::here("/report/data.Rmd"))
#Map Europe
install.packages("eurostat")
library(tidyverse)
library(eurostat)
library(leaflet)
library(sf)
library(geojsonsf)
#merge data with country's coordinate through geojson
EU_coord<- geojsonsf::geojson_sf('data/CNTR_RG_60M_2020_3035.geojson') # source of the geojson file https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/countries
all_data = merge(EU_coord, GDP_diabetes_cal, by.x = "ISO3_CODE", by.y = "country_code")
st_write(all_data, "MapApp/geojson_manipulation/main.geojson")
#mapping
#trying one way
get_eurostat_geospatial(resolution = 10,
nuts_level = 0,
year = 2016)
SHP_0 <- get_eurostat_geospatial(resolution = 10,
nuts_level = 0,
year = 2016)
leaflet(SHP_0) %>%
setView(lng = 15, lat = 50, zoom = 4) %>%
addTiles() %>%
addPolygons(color = "black",
weight = 1,
fillColor = "blue",
fillOpacity = 0.2)
L.geoJSON(geojsonFeature).addTo(map)
#trying the other way
map_lad <- map %>%
leaflet::addPolygons(
data = all_data,  # EU polygon data from geojson
weight = 1,  # line thickness
opacity = 1,  # line transparency
color = "black",  # line colour
fillOpacity = ifelse(  # conditional fill opacity
test = all_data$st_areashape > 1E+09,  # if area is over this value
yes = 0.5,  # then make it half-opaque
no = 0  # otherwise make it entirely transparent
),
fillColor = "red",
label = ~ISO3_CODE  # LAD name as a hover label
)
map_lad
pal <- colorNumeric("viridis", NULL)
leaflet(all_data) %>%
addTiles() %>%
addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
fillColor = ~pal(log10(total_consumption)),
label = ~paste0(ISO3_CODE, ": ", formatC(total_consumption, big.mark = ","))) %>%
addLegend(pal = pal, values = ~log10(total_consumption), opacity = 1.0,
labFormat = labelFormat(transform = function(x) round(10^x)))
knitr::kable(
Caloric_consumption,
align = "lccrr",
caption = "Caloric Consumption",
col.names = c('Country Code', 'Calories from animal protein', 'Calories from plant protein','Calories from carbohydrates', 'Calories from fat', 'Total consumption')
)
kbl(Caloric_consumption,
caption = "**Table 2**: European countries.",
align = c('cccccc')) %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
kable_styling(bootstrap_options = c('striped', 'hover', 'condensed'))
# Data
```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```
To answer our research questions, we used three different datasets. While searching for datasets, we made sure that the years and countries matched for every one of them.
## Wrangling and cleaning
### Caloric consumption
The first dataset we used, downloaded from the portal https://ourworldindata.org/diet-compositions, contains information related to the consumption of macronutrients in calories for different countries. It gives us information on the average nutrition of different countries from 1961 to 2013 :
```{r}
daily_caloric <- read_csv(here::here("data/daily-caloric.csv"))
```
* It is composed of 8981 observations of 7 variables:
+ `Entity` Name of the country
+ `Code` ISO country code
+ `Year`Year of the observation
+ `Calories from animal protein (FAO (2017))` The average per capita supply of calories derived from animal protein    all measured in kilocalories per person per day
+ `Calories from plant protein (FAO (2017))` The average per capita supply of calories derived from plant protein,     all measured in kilocalories per person per day
+ `Calories from fat (FAO (2017))`The average per capita supply of calories derived from fat, all measured in kilocalories per person per day
+ `Calories from carbohydrates (FAO (2017))` The average per capita supply of calories derived from carbohydrates, all measured in kilocalories per person per day
The intake of specific macronutrients (carbohydrates, protein and fats) are derived based on average food composition factors – these factors are derived and presented in the Food and Agriculture Organisation’s (FAO) Food Balance Sheet Handbook (https://www.fao.org/faostat/en/#data).
We will only focus on observations of European countries in the 2000s.
```{r}
daily_caloric <- subset(daily_caloric, Year >= 2000)
EU <- c("AUT", "BEL", "BGR", "HRV", "CYP", "CZE", "DNK", "EST", "FIN", "FRA", "DEU", "GRC", "HUN", "IRL", "ITA", "LVA", "LTU", "LUX", "MLT", "NLD", "POL", "PRT", "ROU", "SVK", "SVN", "ESP", "SWE", "GBR", "CHE")
daily_caloric<-daily_caloric[daily_caloric$Code %in% EU,]
```
We used the ISO code as it is standardized worldwide and does not have the risk of having different names in different tables like the countries' names.
Then, we proceeded to compute the mean of the consumption for each type of macronutrient in each country between the years 2000 and 2013, and the sum of total calories per person per day for each country in order to answer our second research question.
```{r}
setDT(daily_caloric)[ , Calories_from_animal_protein := mean(`Calories from animal protein (FAO (2017))`), by = "Entity"]
setDT(daily_caloric)[ , Calories_from_plant_protein := mean(`Calories from plant protein (FAO (2017))`), by = "Entity"]
setDT(daily_caloric)[ , Calories_from_carbohydrates := mean(`Calories from carbohydrates (FAO (2017))`), by = "Entity"]
setDT(daily_caloric)[ , Calories_from_fat := mean(`Calories from fat (FAO (2017))`), by = "Entity"]
```
We then created a new table by adding the sum of total calories per person per day for each country in order to get a broader view with the total consumption of calories. To make sure that the joining of tables go smoothly, we also removed duplicates and the country name column.
```{r}
Caloric_consumption <- data.table(daily_caloric$Entity,daily_caloric$Code,daily_caloric$Calories_from_animal_protein, daily_caloric$Calories_from_plant_protein,daily_caloric$Calories_from_carbohydrates,daily_caloric$Calories_from_fat)
Caloric_consumption <-Caloric_consumption[!duplicated(Caloric_consumption)]
Caloric_consumption <- Caloric_consumption[,-1]
colnames(Caloric_consumption) <- c("country_code", "cal_prot_animal", "cal_prot_plant", "cal_carbs","cal_fat")
Caloric_consumption <-Caloric_consumption %>%
group_by(country_code) %>%
mutate(
total_consumption = sum(c(cal_prot_animal,cal_prot_plant,cal_carbs,cal_fat)))
```
Our assumption was that a county's wealth may fluctuate over the course of 10 years (ex: a dip during the economic crisis of 2008) but an overall mean is sufficient to compare the different countries and their riches.
* We now have a dataframe with the following variables :
+ `country_code` ISO country code
+ `cal_prot_animal`The mean of the calories from animal protein consumed in each country in the years 2000-2013
+ `cal_prot_plant` The mean of the calories from plant protein consumed in each country in the years 2000-2013
+ `cal_carbs`The mean of the calories from carbohydrates consumed in each country in the years 2000-2013
+ `cal_fat` The mean of the calories from fat consumed in each country in the years 2000-2013
+ `total_consumption` The total consumption based on the means of the consumption of each type of macronutrients in    each countries in the years 2000-2013
The final table is the following:
```{r}
kbl(Caloric_consumption,
caption = "**Table 1**: Caloric Consumption",
col.names = c('Country Code', 'Calories from animal protein', 'Calories from plant protein','Calories from carbohydrates', 'Calories from fat', 'Total consumption'),
align = c('cccccc')) %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
kable_styling(bootstrap_options = c('striped', 'hover', 'condensed'))
```
### GDP
Our second dataset, downloaded from the portal https://data.worldbank.org, gives us information about the GDP of many countries over the course of 60 years (1960-2020).
```{r}
GDP <- read_excel(here::here("data/GDP(1960-2020).xls"))
```
* It is composed of 266 observations of 65 variables :
+ `Country Name` Name of the country
+ `Country Code` ISO country code
+ `Indicator Name` equal to "GDP in current US$" for every row
+ `Indicator Code` equal to "NY.GDP.MKTP.CD" for every row
+ And a variable for each year from 1960 to 2020
As we can see below, RStudio imported the Excel file as is, and so our column names found themselves at the 3rd row and therefore column names of columns 3 to 65 have been attributed numbers.
```{r}
GDP
```
We decided to fix that and to filter out the years that is in our interest and that we have in common with other tables, so the years 2000-2013. We decided to get rid of the `Indicator Name` and `Indicator Code` variables as well since the values are the same for every row and they do not provide additional useful information.
```{r}
colnames(GDP) <- GDP[3,]
GDP <- GDP[-c(1:3),-c(3:44,59:65)]
```
Now, we want to filter out the European countries, just like in the first table :
```{r}
GDP <- GDP[GDP$"Country Code" %in% EU,]
```
In order to join tables easily, we transformed the columns corresponding to different years to a single “year” column, in order to have at each row of this dataset the GDP of a certain country at a certain year.
```{r}
GDP <- GDP %>% pivot_longer(c('2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012','2013'),names_to = "Year",values_to = "Gross Domestic Product")
```
To make it easier to manipulate data, we decided to rename our variables for this table as well. We also made sure that the type of our numeric variable (GDP) was numeric and not character, like it was by default. In order to have graphs that are easy to read in the exploratory data analysis, we also decided to divide the `avg_gdp` column by a billion.
```{r}
colnames(GDP) <- c("country_name","country_code","year","avg_gdp")
GDP$avg_gdp <- as.numeric(GDP$avg_gdp)/1000000000
```
Lastly, we computed the average GDP for each country over the years 2000-2013 in order to be able to plot different variables together.
```{r}
GDP_summarized <- GDP %>%
group_by(country_name, country_code) %>%
summarize(avg_gdp = mean(avg_gdp))
kbl(GDP_summarized,
caption = "**Table 2**: GDP",
col.names = c('Country Name', 'Country Code', 'Average GDP'),
align = c('cccccc')) %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
kable_styling(bootstrap_options = c('striped', 'hover', 'condensed'))
```
We now have a dataframe with the following variables :
+ `country_name` name of the country
+ `country_code` ISO code of the country
+ `avg_gdp` the average GDP of a country over the course of 2000-2013
### Diabetes
The third dataset, downloaded from https://www.ncdrisc.org/data-downloads-diabetes.html, gives us information about the age-standardised diabetes prevalence for each country and gender from 1980 to 2014.
```{r}
Diabetes <- read_csv(here::here("data/Diabetes.csv"))
```
* It is composed of 14'000 observations for 7 variables :
+ `Country/Region/World ` Name of the country
+ `ISO` ISO country code
+ `Sex` Gender for which the diabetes prevalence is measured in a certain country at a certain year
+ `Year` Year of observation (1980-2014)
+ `Age-standardised diabetes prevalence` Diabetes rate considering all ages
+ `Lower 95% uncertainty interval` Lower confidence interval limit for the diabetes rate
+ `Upper 95% uncertainty interval` Higher confidence interval limit for the diabetes rate
Like with the first 2 datasets, we filtered our data to keep only European countries and observations between the years 2000 and 2013.
```{r}
Diabetes <- subset(Diabetes, Year >= 2000 , Year <=2013)
Diabetes_EU<-Diabetes[Diabetes$`ISO` %in% EU,]
kable(Diabetes_EU)
```
We also decided not to use the 95% confidence interval variable.
```{r}
Diabetes_EU <- Diabetes_EU[-c(6,7)]
colnames(Diabetes_EU)<-c("country","ISO","sex","year","prop_diabetes")
```
Then, we separated our dataset into two subsets. One with data about men :
```{r}
Diabetes_EU_men <-subset(Diabetes_EU, sex=="Men")
kable(Diabetes_EU_men)
```
Another one with data about women :
```{r}
Diabetes_EU_women <-subset(Diabetes_EU, sex=="Women")
kable(Diabetes_EU_women)
```
We then changed the variable names of these 2 subsets to facilitate joining tables later on.
```{r}
colnames(Diabetes_EU_men)<-c("country","country_code","sex","year","prop_men_diabetes")
colnames(Diabetes_EU_women)<-c("country","country_code","sex","year","prop_women_diabetes")
```
Finally we grouped observations by country to get the mean prevalence/rate of diabetes between 2000 and 2013 for each European country :
* For men :
```{r}
Diabetes_EU_men <- Diabetes_EU_men %>%
group_by(country_code) %>%
summarize(prop_men_diabetes = mean(prop_men_diabetes))
View(Diabetes_EU_men)
install.packages("leaflet")
library(leaflet)
